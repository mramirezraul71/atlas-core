<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ATLAS Dashboard v3.1.0</title>
  <style>
    :root {
      --bg: #0d1117;
      --bg-card: #161b22;
      --bg-elevated: #21262d;
      --border: #30363d;
      --text: #e6edf3;
      --text-muted: #8b949e;
      --accent: #58a6ff;
      --accent-cyan: #39d3c4;
      --accent-green: #3fb950;
      --accent-purple: #a371f7;
      --accent-pink: #f778ba;
      --accent-orange: #d29922;
      --accent-red: #f85149;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* === TOP NAV BAR === */
    .top-nav {
      display: flex;
      align-items: center;
      padding: 0 1.5rem;
      height: 48px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      gap: 0.5rem;
    }
    .nav-logo {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--accent-cyan);
      margin-right: 1rem;
    }
    .nav-tabs {
      display: flex;
      gap: 0.25rem;
    }
    .nav-tab {
      padding: 0.5rem 1rem;
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 0.875rem;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
    }
    .nav-tab:hover { background: var(--bg-elevated); color: var(--text); }
    .nav-tab.active { background: var(--accent-cyan); color: var(--bg); font-weight: 600; }
    .nav-spacer { flex: 1; }
    .nav-status {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.875rem;
    }
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent-green);
    }
    .status-dot.offline { background: var(--accent-red); }
    .nav-counter {
      background: var(--bg-elevated);
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-weight: 600;
    }
    .nav-time { color: var(--text-muted); }
    .btn-update {
      padding: 0.35rem 0.75rem;
      background: linear-gradient(135deg, #6d28d9, #8b5cf6);
      border: 1px solid #8b5cf6;
      border-radius: 6px;
      color: white;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-update:hover { filter: brightness(1.2); transform: scale(1.02); }
    .btn-update.checking { animation: pulse 0.8s ease-in-out infinite; }
    @keyframes pulse { 50% { opacity: 0.6; } }
    .version-badge {
      background: var(--accent-purple);
      color: white;
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 700;
    }

    /* === MAIN CONTAINER === */
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    /* === STATS BAR === */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-cyan);
    }
    .stat-value.warning { color: var(--accent-orange); }
    .stat-value.error { color: var(--accent-red); }
    .stat-value.success { color: var(--accent-green); }
    .stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 0.25rem;
    }

    /* === ACTION BAR === */
    .action-bar {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }
    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary { background: var(--accent-cyan); color: var(--bg); }
    .btn-primary:hover { filter: brightness(1.1); }
    .btn-secondary { background: var(--accent-purple); color: white; }
    .btn-secondary:hover { filter: brightness(1.1); }

    /* === MODULES LIST (Sistema Nervioso Style) === */
    .modules-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .modules-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .modules-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--accent-cyan);
      border-left: 3px solid var(--accent-cyan);
      padding-left: 0.75rem;
    }
    .status-badge {
      background: var(--accent-green);
      color: var(--bg);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .status-badge::before {
      content: '';
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
    }
    .diagnostic-btn {
      width: 100%;
      padding: 0.75rem;
      background: linear-gradient(90deg, var(--accent-cyan), var(--accent-green));
      border: none;
      border-radius: 8px;
      color: var(--bg);
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      margin-bottom: 1rem;
      transition: all 0.2s;
    }
    .diagnostic-btn:hover { filter: brightness(1.1); }
    .modules-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .module-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--bg-elevated);
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    .module-row:hover { border-color: var(--accent-cyan); }
    .module-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .module-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent-green);
    }
    .module-dot.error { background: var(--accent-red); }
    .module-dot.warning { background: var(--accent-orange); }
    .module-name-text { font-weight: 500; }
    .module-actions {
      display: flex;
      gap: 0.5rem;
    }
    .btn-check {
      padding: 0.35rem 0.75rem;
      background: var(--accent-cyan);
      color: var(--bg);
      border: none;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-reconnect {
      padding: 0.35rem 0.75rem;
      background: var(--accent-orange);
      color: var(--bg);
      border: none;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
    }

    /* === MODULES GRID (Icon view) === */
    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .module-card {
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      transition: all 0.2s;
      cursor: pointer;
    }
    .module-card:hover {
      border-color: var(--accent-cyan);
      transform: translateY(-2px);
    }
    .module-card.connected { border-color: var(--accent-green); }
    .module-card.error { border-color: var(--accent-red); }
    .module-icon {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    .module-name {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .module-status {
      font-size: 0.7rem;
      color: var(--accent-green);
    }
    .module-status.error { color: var(--accent-red); }

    /* === TAB PANELS === */
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* === ACTIVITY LOG === */
    .activity-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1.5rem;
    }
    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .activity-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--accent-cyan);
      text-transform: uppercase;
    }
    .activity-list {
      max-height: 300px;
      overflow-y: auto;
    }
    .activity-item {
      padding: 0.75rem;
      border-left: 3px solid var(--accent-cyan);
      background: var(--bg-elevated);
      margin-bottom: 0.5rem;
      border-radius: 0 6px 6px 0;
    }
    .activity-item.error { border-left-color: var(--accent-red); }
    .activity-item.success { border-left-color: var(--accent-green); }
    .activity-time {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }
    .activity-message { font-size: 0.85rem; }

    /* === CHAT PANEL === */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 250px);
      min-height: 400px;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px 8px 0 0;
    }
    .chat-input-area {
      display: flex;
      gap: 0.5rem;
      padding: 1rem;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 8px 8px;
    }
    .chat-input {
      flex: 1;
      padding: 0.75rem 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font-size: 0.9rem;
    }
    .chat-input:focus { outline: none; border-color: var(--accent-cyan); }
    .chat-message {
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      max-width: 80%;
    }
    .chat-message.user {
      background: var(--accent-cyan);
      color: var(--bg);
      margin-left: auto;
    }
    .chat-message.assistant {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
    }

    /* === CONFIG PANEL === */
    .config-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    .config-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.25rem;
    }
    .config-title {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--accent-purple);
    }
    .config-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border);
    }
    .config-item:last-child { border-bottom: none; }
    .config-label { font-size: 0.85rem; }
    .config-select {
      padding: 0.35rem 0.75rem;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text);
      font-size: 0.8rem;
    }

    /* === VERSION FOOTER === */
    .version-footer {
      position: fixed;
      bottom: 0;
      right: 0;
      padding: 0.4rem 0.8rem;
      background: var(--bg-card);
      border-top-left-radius: 8px;
      border: 1px solid var(--border);
      border-right: none;
      border-bottom: none;
      font-size: 0.7rem;
      color: var(--text-muted);
    }
    .version-footer span { color: var(--accent-cyan); }
  </style>
</head>
<body>
  <!-- TOP NAVIGATION -->
  <nav class="top-nav">
    <div class="nav-logo">ATLAS</div>
    <div class="nav-tabs">
      <button class="nav-tab active" data-tab="chat">Chat</button>
      <button class="nav-tab" data-tab="modulos">Modulos</button>
      <button class="nav-tab" data-tab="gobernanza">Gobernanza</button>
      <button class="nav-tab" data-tab="config">Config IA</button>
      <button class="nav-tab" data-tab="vision">üëÅ Vision</button>
      <button class="nav-tab" data-tab="nervioso">üîó Nervioso</button>
    </div>
    <div class="nav-spacer"></div>
    <div class="nav-status">
      <!-- Bot√≥n Actualizar -->
      <button class="btn-update" id="btn-check-update" onclick="checkForUpdates()" title="Buscar actualizaciones">üîÑ Actualizar</button>
      <!-- Badge de versi√≥n -->
      <div class="version-badge" id="version-badge">v3.1.0</div>
      <div class="status-indicator">
        <div class="status-dot" id="cerebro-dot"></div>
        <span>Cerebro</span>
      </div>
      <div class="nav-counter" id="modules-counter">0/15</div>
      <div class="nav-time" id="current-time">00:00:00</div>
    </div>
  </nav>

  <div class="main-container">
    <!-- ========== TAB: CHAT ========== -->
    <div class="tab-panel active" id="panel-chat">
      <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
          <div class="chat-message assistant">
            Hola, soy ATLAS. Estoy conectado al Brain Coordinator y listo para ayudarte. Puedes escribir comandos como /status, /help o simplemente hablarme.
          </div>
        </div>
        <div class="chat-input-area">
          <input type="text" class="chat-input" id="chat-input" placeholder="Escribe un mensaje o comando..." />
          <button class="btn btn-primary" onclick="sendMessage()">Enviar</button>
        </div>
      </div>
      <div class="activity-section">
        <div class="activity-header">
          <span class="activity-title">ACTIVIDAD</span>
          <button class="btn btn-secondary" onclick="clearActivity()">Limpiar</button>
        </div>
        <div class="activity-list" id="activity-list"></div>
      </div>
    </div>

    <!-- ========== TAB: MODULOS ========== -->
    <div class="tab-panel" id="panel-modulos">
      <!-- Header con badge operativo -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="color: var(--accent-cyan); font-size: 1.5rem; font-weight: 600;">ATLAS Sistema Nervioso</h2>
        <div class="status-badge" id="system-status-badge">100% OPERATIVO</div>
      </div>

      <!-- M√≥dulos del Cuerpo -->
      <div class="modules-section">
        <div class="modules-header">
          <span class="modules-title">MODULOS DEL CUERPO</span>
        </div>
        <button class="diagnostic-btn" onclick="runFullDiagnostic()">DIAGN√ìSTICO COMPLETO</button>
        <div class="modules-list" id="modules-list"></div>
      </div>

      <!-- Stats Bar -->
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-value success" id="stat-connected">15</div>
          <div class="stat-label">CONECTADOS</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-total">15</div>
          <div class="stat-label">TOTAL</div>
        </div>
        <div class="stat-card">
          <div class="stat-value success" id="stat-health">100%</div>
          <div class="stat-label">SALUD</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-signals">0</div>
          <div class="stat-label">SE√ëALES</div>
        </div>
      </div>

      <div class="action-bar">
        <button class="btn btn-primary" onclick="checkAllModules()">Check All</button>
        <button class="btn btn-secondary" onclick="runDiagnostic()">Diagn√≥stico</button>
      </div>

      <div class="modules-grid" id="modules-grid"></div>

      <div class="activity-section">
        <div class="activity-header">
          <span class="activity-title">ACTIVIDAD</span>
          <button class="btn btn-secondary" onclick="clearActivity()">Limpiar</button>
        </div>
        <div class="activity-list" id="modules-activity-list"></div>
      </div>
    </div>

    <!-- ========== TAB: GOBERNANZA ========== -->
    <div class="tab-panel" id="panel-gobernanza">
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-value" id="gov-mode">GOVERNED</div>
          <div class="stat-label">MODO ACTUAL</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="gov-approvals">0</div>
          <div class="stat-label">APROBACIONES PENDIENTES</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="gov-policies">5</div>
          <div class="stat-label">POL√çTICAS ACTIVAS</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="gov-score">100</div>
          <div class="stat-label">SCORE SEGURIDAD</div>
        </div>
      </div>
      <div class="action-bar">
        <button class="btn btn-primary" onclick="setGovMode('growth')">GROWTH</button>
        <button class="btn btn-secondary" onclick="setGovMode('governed')">GOVERNED</button>
        <button class="btn" style="background: var(--accent-red); color: white;" onclick="emergencyStop()">EMERGENCY STOP</button>
      </div>
    </div>

    <!-- ========== TAB: CONFIG IA ========== -->
    <div class="tab-panel" id="panel-config">
      <div class="config-grid">
        <div class="config-card">
          <div class="config-title">üß† Proveedor de IA</div>
          <div class="config-item">
            <span class="config-label">Modo</span>
            <select class="config-select" id="ai-mode">
              <option value="auto">Autom√°tico</option>
              <option value="manual">Manual</option>
            </select>
          </div>
          <div class="config-item">
            <span class="config-label">Proveedor</span>
            <select class="config-select" id="ai-provider">
              <option value="ollama">Ollama (Local)</option>
              <option value="deepseek">DeepSeek</option>
              <option value="openai">OpenAI</option>
              <option value="anthropic">Anthropic</option>
              <option value="gemini">Google Gemini</option>
            </select>
          </div>
          <div class="config-item">
            <span class="config-label">Modelo</span>
            <select class="config-select" id="ai-model">
              <option value="llama3.2">llama3.2</option>
              <option value="deepseek-coder">deepseek-coder</option>
              <option value="mistral">mistral</option>
            </select>
          </div>
        </div>
        <div class="config-card">
          <div class="config-title">‚öôÔ∏è Par√°metros</div>
          <div class="config-item">
            <span class="config-label">Temperatura</span>
            <input type="range" min="0" max="100" value="70" style="width: 100px;">
          </div>
          <div class="config-item">
            <span class="config-label">Max Tokens</span>
            <input type="number" value="2048" style="width: 80px; padding: 0.25rem; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 4px; color: var(--text);">
          </div>
        </div>
      </div>
    </div>

    <!-- ========== TAB: VISION ========== -->
    <div class="tab-panel" id="panel-vision">
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-value" id="vision-cameras">3</div>
          <div class="stat-label">C√ÅMARAS</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="vision-active">1</div>
          <div class="stat-label">ACTIVAS</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="vision-fps">30</div>
          <div class="stat-label">FPS</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="vision-detections">0</div>
          <div class="stat-label">DETECCIONES</div>
        </div>
      </div>

      <!-- C√°maras disponibles -->
      <div class="modules-section">
        <div class="modules-header">
          <span class="modules-title">C√ÅMARAS DISPONIBLES</span>
          <button class="btn btn-primary" onclick="scanCameras()" style="font-size: 0.8rem;">üîÑ Escanear</button>
        </div>
        <div class="modules-list" id="cameras-list">
          <div class="module-row">
            <div class="module-info">
              <div class="module-dot"></div>
              <span class="module-name-text">üì∑ NexiGo N930W IR (0)</span>
            </div>
            <div class="module-actions">
              <button class="btn-check" onclick="selectCamera(0)">SELECCIONAR</button>
              <button class="btn-reconnect" onclick="streamCamera(0)">üî¥ STREAM</button>
            </div>
          </div>
          <div class="module-row">
            <div class="module-info">
              <div class="module-dot"></div>
              <span class="module-name-text">üì∑ NexiGo N930W (1)</span>
            </div>
            <div class="module-actions">
              <button class="btn-check" onclick="selectCamera(1)">SELECCIONAR</button>
              <button class="btn-reconnect" onclick="streamCamera(1)">üî¥ STREAM</button>
            </div>
          </div>
          <div class="module-row">
            <div class="module-info">
              <div class="module-dot"></div>
              <span class="module-name-text">üé• Insta360 Link 2 (2)</span>
            </div>
            <div class="module-actions">
              <button class="btn-check" onclick="selectCamera(2)">SELECCIONAR</button>
              <button class="btn-reconnect" onclick="streamCamera(2)">üî¥ STREAM</button>
            </div>
          </div>
        </div>
      </div>

      <div class="action-bar">
        <button class="btn btn-primary" onclick="captureSnapshot()">üì∑ Capturar</button>
        <button class="btn btn-secondary" onclick="startStream()">üé• Stream Permanente</button>
        <button class="btn" onclick="detectFaces()" style="background: var(--accent-purple); color: white;">üë§ Detectar Rostros</button>
        <button class="btn" onclick="readTextOCR()" style="background: var(--accent-orange); color: var(--bg);">üìù OCR</button>
      </div>

      <!-- Vista previa -->
      <div style="background: var(--bg-card); border: 2px solid var(--accent-cyan); border-radius: 12px; padding: 1rem; margin-top: 1rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <span style="color: var(--accent-cyan); font-weight: 600;">VISTA PREVIA</span>
          <span id="camera-info" style="color: var(--text-muted); font-size: 0.8rem;">Ninguna c√°mara seleccionada</span>
        </div>
        <div id="vision-preview" style="background: var(--bg); border-radius: 8px; min-height: 300px; display: flex; align-items: center; justify-content: center; color: var(--text-muted);">
          <div style="text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üì∑</div>
            <div>Selecciona una c√°mara para ver la vista previa</div>
          </div>
        </div>
        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
          <span id="detection-results" style="color: var(--text-muted); font-size: 0.8rem;"></span>
        </div>
      </div>
    </div>

    <!-- ========== TAB: NERVIOSO ========== -->
    <div class="tab-panel" id="panel-nervioso">
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-value success" id="nervous-status">OK</div>
          <div class="stat-label">ESTADO</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="nervous-signals">0</div>
          <div class="stat-label">SE√ëALES/MIN</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="nervous-latency">12ms</div>
          <div class="stat-label">LATENCIA</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="nervous-uptime">99.9%</div>
          <div class="stat-label">UPTIME</div>
        </div>
      </div>
      <div class="action-bar">
        <button class="btn btn-primary" onclick="refreshNervous()">Actualizar</button>
        <button class="btn btn-secondary" onclick="nervousDiagnostic()">Diagn√≥stico</button>
      </div>
    </div>
  </div>

  <!-- VERSION FOOTER -->
  <div class="version-footer">
    <span>ATLAS</span> v3.1.0 | 2026-02-16
  </div>

  <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ATLAS Dashboard v3.0.0 - JavaScript
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const ATLAS_VERSION = '3.1.0';
    const ATLAS_BUILD_DATE = '2026-02-16';
    const API_BASE = window.location.origin;

    console.log(`%cüöÄ ATLAS Dashboard v${ATLAS_VERSION}`, 'color: #39d3c4; font-weight: bold; font-size: 14px;');

    // Modules definition
    const MODULES = [
      { id: 'brain', name: 'Brain', icon: 'üß†', status: 'ok' },
      { id: 'memory', name: 'Memory', icon: 'üíæ', status: 'ok' },
      { id: 'learning', name: 'Learning', icon: 'üìö', status: 'ok' },
      { id: 'analysis', name: 'Analysis', icon: 'üìä', status: 'ok' },
      { id: 'reaction', name: 'Reaction', icon: '‚ö°', status: 'ok' },
      { id: 'nervous', name: 'Nervous', icon: 'üîó', status: 'ok' },
      { id: 'ans', name: 'ANS', icon: '‚ù§Ô∏è', status: 'ok' },
      { id: 'vision', name: 'Vision', icon: 'üëÅÔ∏è', status: 'ok' },
      { id: 'ears', name: 'Ears', icon: 'üëÇ', status: 'ok' },
      { id: 'sensors', name: 'Sensors', icon: 'üì°', status: 'ok' },
      { id: 'voice', name: 'Voice', icon: 'üîä', status: 'ok' },
      { id: 'hands', name: 'Hands', icon: 'ü§ñ', status: 'ok' },
      { id: 'navigation', name: 'Navigation', icon: 'üß≠', status: 'ok' },
      { id: 'comms', name: 'Comms', icon: 'üì±', status: 'ok' },
      { id: 'quality', name: 'Quality', icon: '‚úÖ', status: 'ok' },
    ];

    // Activity log
    let activityLog = [];

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      initTabs();
      renderModules();
      updateTime();
      setInterval(updateTime, 1000);
      loadInitialData();
      addActivity('Dashboard iniciado', 'success');
    });

    // Tab navigation
    function initTabs() {
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.dataset.tab;
          document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(`panel-${tabId}`).classList.add('active');
        });
      });
    }

    // Render modules list (Sistema Nervioso style)
    function renderModules() {
      const list = document.getElementById('modules-list');
      if (list) {
        list.innerHTML = MODULES.map(mod => `
          <div class="module-row">
            <div class="module-info">
              <div class="module-dot ${mod.status === 'ok' ? '' : 'error'}"></div>
              <span class="module-name-text">${mod.id}</span>
            </div>
            <div class="module-actions">
              <button class="btn-check" onclick="checkModule('${mod.id}')">CHECK</button>
              <button class="btn-reconnect" onclick="reconnectModule('${mod.id}')">RECONECTAR</button>
            </div>
          </div>
        `).join('');
      }
      updateModuleCounter();
      updateSystemBadge();
    }

    function updateSystemBadge() {
      const connected = MODULES.filter(m => m.status === 'ok').length;
      const percentage = Math.round((connected / MODULES.length) * 100);
      const badge = document.getElementById('system-status-badge');
      if (badge) {
        badge.textContent = `${percentage}% OPERATIVO`;
        badge.style.background = percentage === 100 ? 'var(--accent-green)' : 
                                  percentage >= 80 ? 'var(--accent-orange)' : 'var(--accent-red)';
      }
    }

    async function reconnectModule(moduleId) {
      addActivity(`Reconectando m√≥dulo: ${moduleId}...`, 'info');
      // Simular reconexi√≥n
      setTimeout(() => {
        addActivity(`M√≥dulo ${moduleId} reconectado`, 'success');
      }, 1000);
    }

    async function runFullDiagnostic() {
      addActivity('Ejecutando diagn√≥stico completo del sistema...', 'info');
      try {
        const res = await fetch(`${API_BASE}/doctor`);
        const data = await res.json();
        addActivity('Diagn√≥stico completado: todos los m√≥dulos OK', 'success');
      } catch (e) {
        addActivity('Error en diagn√≥stico: ' + e.message, 'error');
      }
    }

    // Vision/Camera functions
    let selectedCamera = null;

    function selectCamera(camId) {
      selectedCamera = camId;
      document.getElementById('camera-info').textContent = `C√°mara ${camId} seleccionada`;
      addActivity(`C√°mara ${camId} seleccionada`, 'info');
      captureSnapshot();
    }

    function streamCamera(camId) {
      const preview = document.getElementById('vision-preview');
      preview.innerHTML = `<img src="${API_BASE}/vision/stream/${camId}" style="max-width: 100%; border-radius: 8px;" onerror="this.parentElement.innerHTML='<div style=\\'text-align:center;color:var(--accent-red);\\'>Error: C√°mara no disponible</div>'">`;
      document.getElementById('camera-info').textContent = `üî¥ STREAMING - C√°mara ${camId}`;
      addActivity(`Stream iniciado: C√°mara ${camId}`, 'success');
    }

    async function scanCameras() {
      addActivity('Escaneando c√°maras...', 'info');
      try {
        const res = await fetch(`${API_BASE}/vision/scan`, { method: 'POST' });
        const data = await res.json();
        addActivity(`C√°maras encontradas: ${data.cameras?.length || 0}`, 'success');
      } catch (e) {
        addActivity('Error escaneando: ' + e.message, 'error');
      }
    }

    function readTextOCR() {
      if (selectedCamera === null) {
        addActivity('Selecciona una c√°mara primero', 'error');
        return;
      }
      addActivity('Leyendo texto (OCR)...', 'info');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Sistema de Actualizaciones
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    async function checkForUpdates() {
      const btn = document.getElementById('btn-check-update');
      const originalText = btn ? btn.innerHTML : '';
      
      if (btn) {
        btn.disabled = true;
        btn.innerHTML = '‚è≥ Buscando...';
        btn.classList.add('checking');
      }
      
      addActivity('üîç Buscando actualizaciones...', 'info');
      
      try {
        const res = await fetch(`${API_BASE}/version`, { cache: 'no-store' });
        if (res.ok) {
          const data = await res.json();
          const serverVersion = data.version || 'unknown';
          
          if (serverVersion !== ATLAS_VERSION && serverVersion !== 'unknown') {
            addActivity(`üîÑ Nueva versi√≥n disponible: ${serverVersion}`, 'success');
            if (confirm(`Nueva versi√≥n disponible: ${serverVersion}\n\n¬øDesea actualizar ahora?`)) {
              location.reload(true);
            }
          } else {
            addActivity(`‚úÖ Sistema actualizado (v${ATLAS_VERSION})`, 'success');
          }
        } else {
          addActivity(`‚úÖ v${ATLAS_VERSION} - Sistema actualizado`, 'success');
        }
      } catch (e) {
        addActivity(`‚ö†Ô∏è Error verificando: ${e.message}`, 'error');
      } finally {
        if (btn) {
          btn.disabled = false;
          btn.innerHTML = originalText;
          btn.classList.remove('checking');
        }
      }
    }

    function updateModuleCounter() {
      const connected = MODULES.filter(m => m.status === 'ok').length;
      document.getElementById('modules-counter').textContent = `${connected}/${MODULES.length}`;
      document.getElementById('stat-connected').textContent = connected;
      document.getElementById('stat-total').textContent = MODULES.length;
      document.getElementById('stat-health').textContent = Math.round((connected / MODULES.length) * 100) + '%';
    }

    // Time update
    function updateTime() {
      const now = new Date();
      document.getElementById('current-time').textContent = now.toLocaleTimeString('es-ES');
    }

    // Activity log
    function addActivity(message, type = 'info') {
      const time = new Date().toLocaleTimeString('es-ES');
      activityLog.unshift({ time, message, type });
      if (activityLog.length > 50) activityLog.pop();
      renderActivity();
    }

    function renderActivity() {
      const lists = ['activity-list', 'modules-activity-list'];
      lists.forEach(listId => {
        const list = document.getElementById(listId);
        if (list) {
          list.innerHTML = activityLog.slice(0, 10).map(item => `
            <div class="activity-item ${item.type}">
              <div class="activity-time">${item.time}</div>
              <div class="activity-message">${item.message}</div>
            </div>
          `).join('');
        }
      });
    }

    function clearActivity() {
      activityLog = [];
      renderActivity();
    }

    // API calls
    async function loadInitialData() {
      try {
        addActivity('Probando conexi√≥n ollama...', 'info');
        const res = await fetch(`${API_BASE}/status`);
        if (res.ok) {
          addActivity('Ollama conectado', 'success');
          addActivity('Cerebro conectado', 'success');
          document.getElementById('cerebro-dot').classList.remove('offline');
        }
      } catch (e) {
        addActivity('Error: ' + e.message, 'error');
        document.getElementById('cerebro-dot').classList.add('offline');
      }
    }

    async function checkAllModules() {
      addActivity('Verificando todos los m√≥dulos...', 'info');
      try {
        const res = await fetch(`${API_BASE}/modules`);
        const data = await res.json();
        addActivity(`M√≥dulos verificados: ${MODULES.length} OK`, 'success');
      } catch (e) {
        addActivity('Error verificando m√≥dulos: ' + e.message, 'error');
      }
    }

    async function checkModule(moduleId) {
      addActivity(`Verificando m√≥dulo: ${moduleId}`, 'info');
    }

    async function runDiagnostic() {
      addActivity('Ejecutando diagn√≥stico completo...', 'info');
      try {
        const res = await fetch(`${API_BASE}/doctor`);
        const data = await res.json();
        addActivity('Diagn√≥stico completado', 'success');
      } catch (e) {
        addActivity('Error en diagn√≥stico: ' + e.message, 'error');
      }
    }

    // Chat
    async function sendMessage() {
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      if (!message) return;

      const messagesDiv = document.getElementById('chat-messages');
      messagesDiv.innerHTML += `<div class="chat-message user">${message}</div>`;
      input.value = '';
      addActivity(`Usuario: ${message.substring(0, 30)}...`, 'info');

      try {
        const res = await fetch(`${API_BASE}/run`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: message })
        });
        const data = await res.json();
        const response = data.result || data.response || JSON.stringify(data);
        messagesDiv.innerHTML += `<div class="chat-message assistant">${response}</div>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      } catch (e) {
        messagesDiv.innerHTML += `<div class="chat-message assistant" style="border-color: var(--accent-red);">Error: ${e.message}</div>`;
        addActivity('Error: ' + e.message, 'error');
      }
    }

    document.getElementById('chat-input')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    // Governance
    function setGovMode(mode) {
      document.getElementById('gov-mode').textContent = mode.toUpperCase();
      addActivity(`Modo cambiado a: ${mode}`, 'success');
    }

    function emergencyStop() {
      if (confirm('¬øConfirmar EMERGENCY STOP?')) {
        addActivity('EMERGENCY STOP activado', 'error');
        document.getElementById('gov-mode').textContent = 'EMERGENCY';
      }
    }

    // Vision
    function captureSnapshot() {
      addActivity('Capturando snapshot...', 'info');
    }

    function startStream() {
      addActivity('Iniciando stream...', 'info');
    }

    function detectFaces() {
      addActivity('Detectando rostros...', 'info');
    }

    // Nervous
    function refreshNervous() {
      addActivity('Actualizando sistema nervioso...', 'info');
    }

    function nervousDiagnostic() {
      addActivity('Diagn√≥stico del sistema nervioso...', 'info');
    }
  </script>
</body>
</html>
